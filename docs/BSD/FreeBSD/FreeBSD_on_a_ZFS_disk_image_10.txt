

FreeBSD 10.0 on a ZFS disk image
--------------------------------


A disk image is created, a memory device is then attached,
partitioned and the boot code added. Buildworld and buildkernel are
then ran and installed. Last "distribution" is ran, some 
configuration files are copied in, and everything is unmounted.
This document was made with an installation of FreeBSD 10.0-RELEASE.


   dd if=/dev/zero of=binary.img bs=1M count=1000
   mdconfig -a -t vnode -f binary.img -u 0
   gpart create -s gpt md0
   gpart add -s 64k -t freebsd-boot md0
   gpart add -t freebsd-zfs md0
   gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 md0 
   zpool create -o altroot=/mnt zroot /dev/md0p2
   zfs create -o mountpoint=/ zroot/10
   zpool set bootfs=zroot/10 zroot 
   make -C /usr/src buildworld
   make -C /usr/src buildkernel 
   make -C /usr/src installworld  DESTDIR=/mnt
   make -C /usr/src installkernel DESTDIR=/mnt
   make -C /usr/src distribution  DESTDIR=/mnt 
   echo 'zfs_enable="YES"' >>/mnt/etc/rc.conf 
   echo 'zfs_load="YES"' >>/mnt/boot/loader.conf
   echo 'vfs.root.mountfrom="zfs:zroot/10"' >>/mnt/boot/loader.conf 
   zpool export zroot 
   mdconfig -d -u 0


The resulting image is named "binary.img". 




(C) 2014 Documentation, cgraf
